{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Journal</title>
    <link rel="stylesheet" href="{% static 'css/mind_css/journal.css' %}">
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                </div>
                <div>
                    <h1>My Journal</h1>
                    <p class="subtitle">Your daily thoughts & memories</p>
                </div>
            </div>
            <div class="date-nav">
                <button onclick="changeDate(-1)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
                <input type="date" id="dateInput" onchange="loadEntry()">
                <button onclick="changeDate(1)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <div class="toolbar">
            <div class="mode-tabs">
                <div class="mode-tab active" data-mode="text" onclick="switchModeTab('text')">
                    <svg viewBox="0 0 24 24">
                        <line x1="4" y1="7" x2="20" y2="7"></line>
                        <line x1="4" y1="12" x2="20" y2="12"></line>
                        <line x1="4" y1="17" x2="20" y2="17"></line>
                    </svg>
                    Text
                </div>
                <div class="mode-tab" data-mode="draw" onclick="switchModeTab('draw')">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                    </svg>
                    Draw
                </div>
                <div class="mode-tab" data-mode="image" onclick="switchModeTab('image')">
                    <svg viewBox="0 0 24 24">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                    Images
                </div>
            </div>

            <!-- Text Tools -->
            <div class="tools-content active" id="textTools">
                <div class="tool-section">
                    <span class="tool-label">Font:</span>
                    <select id="fontFamily" onchange="applyFormatting('fontName', this.value)">
                        <option value="Arial">Arial</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Courier New">Courier</option>
                        <option value="Times New Roman">Times</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Comic Sans MS">Comic Sans</option>
                        <option value="Impact">Impact</option>
                    </select>

                    <input type="number" id="fontSize" value="16" min="8" max="72"
                        oninput="applyFormatting('fontSize', this.value)">

                    <div class="divider"></div>

                    <button class="tool-btn format-btn" onclick="applyFormatting('bold')">
                        <svg viewBox="0 0 24 24">
                            <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                            <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                        </svg>
                        <b>B</b>
                    </button>

                    <button class="tool-btn format-btn" onclick="applyFormatting('italic')">
                        <svg viewBox="0 0 24 24">
                            <line x1="19" y1="4" x2="10" y2="4"></line>
                            <line x1="14" y1="20" x2="5" y2="20"></line>
                            <line x1="15" y1="4" x2="9" y2="20"></line>
                        </svg>
                        <i>I</i>
                    </button>

                    <button class="tool-btn format-btn" onclick="applyFormatting('underline')">
                        <svg viewBox="0 0 24 24">
                            <path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"></path>
                            <line x1="4" y1="21" x2="20" y2="21"></line>
                        </svg>
                        <u>U</u>
                    </button>

                    <div class="divider"></div>

                    <span class="tool-label">Color:</span>
                    <div class="color-picker-group" id="textColorPicker">
                        <div class="color-btn active" style="background: #000000;" data-color="#000000"></div>
                        <div class="color-btn" style="background: #ef4444;" data-color="#ef4444"></div>
                        <div class="color-btn" style="background: #3b82f6;" data-color="#3b82f6"></div>
                        <div class="color-btn" style="background: #10b981;" data-color="#10b981"></div>
                        <div class="color-btn" style="background: #f59e0b;" data-color="#f59e0b"></div>
                        <div class="color-btn" style="background: #8b5cf6;" data-color="#8b5cf6"></div>
                    </div>

                    <div class="divider"></div>

                    <div style="position: relative;">
                        <button class="tool-btn" onclick="toggleHighlightPicker(event)">
                            <svg viewBox="0 0 24 24">
                                <path d="M9 11l-6 6v3h9l3-3"></path>
                            </svg>
                            Highlight
                        </button>
                        <div class="highlight-colors" id="highlightPicker">
                            <button class="color-btn none-btn" onclick="applyFormatting('backColor', 'transparent')"
                                style="background: white; border: 1px dashed #aaa;">üö´</button>
                            <div class="color-btn" style="background: #fef08a;"
                                onclick="applyFormatting('backColor', '#fef08a')"></div>
                            <div class="color-btn" style="background: #a7f3d0;"
                                onclick="applyFormatting('backColor', '#a7f3d0')"></div>
                            <div class="color-btn" style="background: #fecaca;"
                                onclick="applyFormatting('backColor', '#fecaca')"></div>
                            <div class="color-btn" style="background: #bfdbfe;"
                                onclick="applyFormatting('backColor', '#bfdbfe')"></div>
                            <div class="color-btn" style="background: #e9d5ff;"
                                onclick="applyFormatting('backColor', '#e9d5ff')"></div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <button class="tool-btn" onclick="applyFormatting('justifyLeft')">
                        <svg viewBox="0 0 24 24">
                            <line x1="21" y1="10" x2="3" y2="10"></line>
                            <line x1="21" y1="6" x2="3" y2="6"></line>
                            <line x1="15" y1="14" x2="3" y2="14"></line>
                            <line x1="15" y1="18" x2="3" y2="18"></line>
                        </svg>
                    </button>

                    <button class="tool-btn" onclick="applyFormatting('justifyCenter')">
                        <svg viewBox="0 0 24 24">
                            <line x1="18" y1="10" x2="6" y2="10"></line>
                            <line x1="21" y1="6" x2="3" y2="6"></line>
                            <line x1="18" y1="14" x2="6" y2="14"></line>
                            <line x1="21" y1="18" x2="3" y2="18"></line>
                        </svg>
                    </button>

                    <button class="tool-btn" onclick="applyFormatting('justifyRight')">
                        <svg viewBox="0 0 24 24">
                            <line x1="21" y1="10" x2="3" y2="10"></line>
                            <line x1="21" y1="6" x2="3" y2="6"></line>
                            <line x1="21" y1="14" x2="9" y2="14"></line>
                            <line x1="21" y1="18" x2="9" y2="18"></line>
                        </svg>
                    </button>

                    <div class="divider"></div>

                    <button class="tool-btn" onclick="applyFormatting('insertUnorderedList')">
                        <svg viewBox="0 0 24 24">
                            <line x1="8" y1="6" x2="21" y2="6"></line>
                            <line x1="8" y1="12" x2="21" y2="12"></line>
                            <line x1="8" y1="18" x2="21" y2="18"></line>
                            <line x1="3" y1="6" x2="3.01" y2="6"></line>
                            <line x1="3" y1="12" x2="3.01" y2="12"></line>
                            <line x1="3" y1="18" x2="3.01" y2="18"></line>
                        </svg>
                    </button>

                    <button class="tool-btn" onclick="applyFormatting('insertOrderedList')">
                        <svg viewBox="0 0 24 24">
                            <line x1="10" y1="6" x2="21" y2="6"></line>
                            <line x1="10" y1="12" x2="21" y2="12"></line>
                            <line x1="10" y1="18" x2="21" y2="18"></line>
                            <path d="M4 6h1v4"></path>
                            <path d="M4 10h2"></path>
                            <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"></path>
                        </svg>
                    </button>

                    <div class="divider"></div>

                    <button class="tool-btn" onclick="undo()">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 7v6h6"></path>
                            <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
                        </svg>
                        Undo
                    </button>
                    <button class="tool-btn" onclick="clearCanvas()">
                        <svg viewBox="0 0 24 24">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                        </svg>
                        Clear All
                    </button>
                </div>
            </div>

            <!-- Draw Tools -->
            <div class="tools-content" id="drawTools">
                <div class="tool-section">
                    <span class="tool-label">Tool:</span>
                    <button class="tool-btn active" id="drawModeBtn" onclick="setDrawMode('draw')">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                        </svg>
                        Pen
                    </button>
                    <button class="tool-btn" id="eraserModeBtn" onclick="setDrawMode('eraser')">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 20H7L2 15l9-9 7 7-2 2 4 4z"></path>
                        </svg>
                        Eraser
                    </button>
                    <button class="tool-btn" id="highlighterBtn" onclick="toggleHighlighter()">
                        <svg viewBox="0 0 24 24">
                            <path d="M9 11l-6 6v3h9l3-3m0 0l5-5L15 7l-5 5m0 0L7 9"></path>
                        </svg>
                        Highlighter
                    </button>

                    <div class="divider"></div>

                    <span class="tool-label">Color:</span>
                    <div class="color-picker-group" id="drawColorPicker">
                        <div class="color-btn active" style="background: #000000;" data-color="#000000"></div>
                        <div class="color-btn" style="background: #ef4444;" data-color="#ef4444"></div>
                        <div class="color-btn" style="background: #3b82f6;" data-color="#3b82f6"></div>
                        <div class="color-btn" style="background: #10b981;" data-color="#10b981"></div>
                        <div class="color-btn" style="background: #f59e0b;" data-color="#f59e0b"></div>
                        <div class="color-btn" style="background: #8b5cf6;" data-color="#8b5cf6"></div>
                    </div>

                    <div class="divider"></div>

                    <span class="tool-label">Brush Size:</span>
                    <select id="brushSize" onchange="setBrushSize(this.value)">
                        <option value="2">Thin</option>
                        <option value="4" selected>Medium</option>
                        <option value="8">Thick</option>
                        <option value="12">Bold</option>
                    </select>

                    <span class="tool-label" style="margin-left: 10px;">Ctrl +/- to resize eraser</span>

                    <div class="divider"></div>

                    <button class="tool-btn" onclick="undo()">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 7v6h6"></path>
                            <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
                        </svg>
                        Undo
                    </button>
                    <button class="tool-btn" onclick="clearCanvas()">
                        <svg viewBox="0 0 24 24">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                        </svg>
                        Clear All
                    </button>
                </div>
            </div>

            <!-- Image Tools -->
            <div class="tools-content" id="imageTools">
                <div class="tool-section">
                    <button class="tool-btn" onclick="document.getElementById('imageInput').click()">
                        <svg viewBox="0 0 24 24">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                        Upload Image
                    </button>
                    <input type="file" id="imageInput" accept="image/*" onchange="addImage(event)">

                    <div class="divider"></div>

                    <span class="tool-label">Click on any image to move or resize it</span>

                    <div class="divider"></div>

                    <button class="tool-btn" onclick="undo()">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 7v6h6"></path>
                            <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
                        </svg>
                        Undo
                    </button>
                    <button class="tool-btn" onclick="clearCanvas()">
                        <svg viewBox="0 0 24 24">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                        </svg>
                        Clear All
                    </button>
                </div>
            </div>
        </div>

        <div class="canvas-container" id="canvasContainer">
            <canvas id="journalCanvas"></canvas>
            <div class="eraser-cursor" id="eraserCursor"></div>
            <div class="word-editor" id="wordEditor" contenteditable="true"
                data-placeholder="Start typing your journal entry..."></div>
        </div>

        <div class="entry-count" id="entryCount">0 entries saved</div>

        <div id="sentimentModal">
            <div class="modal-content">
                <h2>üß† Emotion Analysis</h2>
                <div id="moodEmoji" style="font-size:40px;margin-bottom:10px;">ü§î</div>
                <canvas id="emotionChart" style="width:100%;max-width:450px;margin:0 auto;display:none;"></canvas>
                <p id="sentimentText">Analyzing your journal...</p>
                <h3 style="margin-top:25px;">üìÖ Mood History</h3>
                <canvas id="moodHistoryChart" style="width:100%;max-width:500px;margin-top:10px;display:none;"></canvas>
                <button class="modal-btn" onclick="closeModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Analyze Button -->
    <button class="tool-btn" style="margin:25px auto;display:block;font-size:16px;padding:12px 20px;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  color:white;border:none;border-radius:16px;
  box-shadow:0 4px 16px rgba(102,126,234,0.4);
  transition:all 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"
        onclick="analyzeSentiment()">
        üß† Analyze Emotions
    </button>
    <button class="tool-btn" style="margin:10px auto;display:block;font-size:16px;padding:12px 20px;
  background:linear-gradient(135deg,#22c55e 0%,#16a34a 100%);
  color:white;border:none;border-radius:16px;
  box-shadow:0 4px 16px rgba(34,197,94,0.4);
  transition:all 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"
        onclick="postToCommunity()"><a href="{% url 'community' %}">
        üåç Post to Community
    </a></button>
    <button class="tool-btn" style="margin:25px auto;display:block;font-size:16px;padding:12px 20px;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  color:white;border:none;border-radius:16px;
  box-shadow:0 4px 16px rgba(102,126,234,0.4);
  transition:all 0.3s;" onmouseover="this.style.transform='scale(1.05)'" target="_blank"><a
            href="{% url 'sentiment_dashboard' %}" style="text-decoration: none;">üìä View Dashboard</a></button>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'js/mind_js/journal.js' %}"></script>

</body>

</html>